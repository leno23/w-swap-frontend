# âœ… é—®é¢˜å·²ä¿®å¤ï¼

## ğŸ¯ é—®é¢˜å›é¡¾

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Contract would revert with reason: missing revert data
```

**æ ¹æœ¬åŸå› ï¼š**
åœ¨ `Factory.sol` çš„ `getPool()` å‡½æ•°ä¸­ï¼Œè®¿é—®ä¸å­˜åœ¨çš„æ± å­æ—¶ä¼šå¯¼è‡´æ•°ç»„è¶Šç•Œï¼Œä½† Solidity ä¸ä¼šè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œåªæ˜¯é™é»˜ revertã€‚

## ğŸ”§ å·²å®Œæˆçš„ä¿®å¤

### 1. âœ… Factory.sol - æ·»åŠ è¾¹ç•Œæ£€æŸ¥
```solidity
// ä¿®å¤å‰ï¼š
return pools[token0][token1][index];  // âŒ è¶Šç•Œä¼šé™é»˜ revert

// ä¿®å¤åï¼š
require(index < pools[token0][token1].length, "Pool index out of bounds");  // âœ…
address pool = pools[token0][token1][index];
require(pool != address(0), "Pool does not exist");  // âœ…
return pool;
```

### 2. âœ… Pool.sol - æ”¹è¿›é”™è¯¯ä¿¡æ¯
```solidity
// æ·»åŠ äº†åˆå§‹åŒ–æ£€æŸ¥
require(sqrtPriceX96 > 0, "Pool not initialized");

// æ”¹è¿›äº†ä½™é¢æ£€æŸ¥é”™è¯¯ä¿¡æ¯
require(balance0Before.add(amount0) <= balance0(), "Insufficient token0 received");
require(balance1Before.add(amount1) <= balance1(), "Insufficient token1 received");
```

### 3. âœ… ä¿®å¤äº† Factory.sol çš„è¯­æ³•é”™è¯¯
ç§»é™¤äº†ç¬¬ 11 è¡Œçš„å¤šä½™å­—ç¬¦ `2`

### 4. âœ… ä¿®å¤äº† hardhat.config.ts
ä½¿ç”¨ç¯å¢ƒå˜é‡è€Œä¸æ˜¯ç©ºå­—ç¬¦ä¸²ä½œä¸ºç§é’¥é…ç½®

### 5. âœ… åˆçº¦ç¼–è¯‘æˆåŠŸ
```
Compiled 48 Solidity files successfully
```

## ğŸ“‹ ä¸‹ä¸€æ­¥æ“ä½œæ¸…å•

### â˜ æ­¥éª¤ 1: åˆ›å»º .env æ–‡ä»¶ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰

åœ¨ `swap-contract` ç›®å½•ä¸‹åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cd swap-contract
touch .env
```

åœ¨ `.env` æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```env
SEPOLIA_RPC_URL=https://sepolia.infura.io/v3/YOUR_INFURA_KEY
# æˆ–ä½¿ç”¨ Alchemy: https://eth-sepolia.g.alchemy.com/v2/YOUR_ALCHEMY_KEY

PRIVATE_KEY=ä½ çš„é’±åŒ…ç§é’¥ï¼ˆä¸è¦åŒ…å«0xå‰ç¼€ï¼‰
# âš ï¸ è­¦å‘Šï¼šæ°¸è¿œä¸è¦æäº¤ .env æ–‡ä»¶åˆ° gitï¼
```

### â˜ æ­¥éª¤ 2: é‡æ–°éƒ¨ç½²åˆçº¦

```bash
cd swap-contract
npx hardhat ignition deploy ignition/modules/MetaNodeSwap.ts --network sepolia
```

**é‡è¦ï¼š** ä¿å­˜éƒ¨ç½²è¾“å‡ºä¸­çš„åœ°å€ï¼åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š

```
Deployed PoolManager to: 0x...
Deployed SwapRouter to: 0x...
Deployed PositionManager to: 0x...
```

### â˜ æ­¥éª¤ 3: æ›´æ–°å‰ç«¯åˆçº¦åœ°å€

ç¼–è¾‘ `/contracts/addresses.ts`ï¼š

```typescript
export const CONTRACT_ADDRESSES = {
  sepolia: {
    poolManager: '0xæ–°çš„PoolManageråœ°å€',      // â† æ›´æ–°è¿™é‡Œ
    positionManager: '0xæ–°çš„PositionManageråœ°å€', // â† æ›´æ–°è¿™é‡Œ
    swapRouter: '0xæ–°çš„SwapRouteråœ°å€',          // â† æ›´æ–°è¿™é‡Œ
  }
} as const;
```

### â˜ æ­¥éª¤ 4: æ›´æ–° Pool ABIï¼ˆé‡è¦ï¼ï¼‰

```bash
# ä»é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
cp swap-contract/artifacts/contracts/MetaNodeSwap/Pool.sol/Pool.json lib/Pool.json
```

### â˜ æ­¥éª¤ 5: é‡å¯å‰ç«¯

```bash
# åœæ­¢å½“å‰æœåŠ¡å™¨ (Ctrl+C)
pnpm dev
```

### â˜ æ­¥éª¤ 6: æµ‹è¯•æ·»åŠ æµåŠ¨æ€§

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:3000
2. è¿æ¥é’±åŒ…
3. å°è¯•æ·»åŠ æµåŠ¨æ€§
4. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„è¯¦ç»†æ—¥å¿—

## ğŸ‰ é¢„æœŸç»“æœ

ç°åœ¨ä½ åº”è¯¥èƒ½çœ‹åˆ°ï¼š

### âœ… æˆåŠŸåœºæ™¯
```
âœ… Pool created!
âœ… Token 0 approved!
âœ… Token 1 approved!
âœ… Liquidity added successfully!
```

### â„¹ï¸ æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰é—®é¢˜ï¼‰
```
âŒ Pool index out of bounds       // æ± å­ä¸å­˜åœ¨ï¼ˆå‰ç«¯ä¼šè‡ªåŠ¨åˆ›å»ºï¼‰
âŒ Pool not initialized           // æ± å­æœªåˆå§‹åŒ–
âŒ Insufficient token0 received   // Token0 è½¬è´¦å¤±è´¥
âŒ Insufficient Token 0 balance   // ä½™é¢ä¸è¶³
âŒ Insufficient allowance         // æˆæƒä¸è¶³
```

## ğŸ†š ä¿®å¤å‰ vs ä¿®å¤å

| åœºæ™¯ | ä¿®å¤å‰ | ä¿®å¤å |
|-----|--------|--------|
| æ± å­ä¸å­˜åœ¨ | âŒ missing revert data | âœ… Pool index out of bounds |
| æ± å­æœªåˆå§‹åŒ– | âŒ missing revert data | âœ… Pool not initialized |
| Token è½¬è´¦å¤±è´¥ | âŒ M0 / M1 | âœ… Insufficient token0/1 received |
| åœ°å€ä¸º 0 | âŒ missing revert data | âœ… Pool does not exist |

## ğŸ“Š å·²åˆ›å»ºçš„è¾…åŠ©å·¥å…·

1. **`/SOLUTION.md`** - è‹±æ–‡ç‰ˆè¯¦ç»†è§£å†³æ–¹æ¡ˆ
2. **`/å¿«é€Ÿä¿®å¤æŒ‡å—.md`** - ä¸­æ–‡å¿«é€ŸæŒ‡å—
3. **`/ä¿®å¤æ€»ç»“.md`** - æœ¬æ–‡ä»¶
4. **`/scripts/debugMint.ts`** - è¯Šæ–­è„šæœ¬
5. **`/swap-contract/scripts/deploy-and-update.sh`** - éƒ¨ç½²è¾…åŠ©è„šæœ¬

## ğŸ” éªŒè¯ä¿®å¤

### æ–¹æ³• 1: æ‰‹åŠ¨æµ‹è¯•
ç›´æ¥åœ¨å‰ç«¯å°è¯•æ·»åŠ æµåŠ¨æ€§ï¼ŒæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ã€‚

### æ–¹æ³• 2: ä½¿ç”¨è¯Šæ–­è„šæœ¬
```bash
# å…ˆæ›´æ–° scripts/debugMint.ts ä¸­çš„é…ç½®
# ç„¶åè¿è¡Œï¼š
npx tsx scripts/debugMint.ts
```

## âš ï¸ å¸¸è§é—®é¢˜

### Q: éƒ¨ç½²æ—¶æç¤º "insufficient funds"
**A:** ç¡®ä¿ä½ çš„é’±åŒ…æœ‰è¶³å¤Ÿçš„ Sepolia ETHï¼ˆè‡³å°‘ 0.1 ETHï¼‰ã€‚è·å–æµ‹è¯•å¸ï¼šhttps://sepoliafaucet.com/

### Q: éƒ¨ç½²åå‰ç«¯è¿˜æ˜¯æŠ¥é”™
**A:** æ£€æŸ¥ï¼š
- [ ] æ˜¯å¦æ›´æ–°äº† `contracts/addresses.ts` ä¸­çš„åœ°å€ï¼Ÿ
- [ ] æ˜¯å¦é‡å¯äº†å‰ç«¯å¼€å‘æœåŠ¡å™¨ï¼Ÿ
- [ ] æµè§ˆå™¨æ˜¯å¦åˆ·æ–°äº†ï¼Ÿ

### Q: å¦‚ä½•è·å– Sepolia RPC URLï¼Ÿ
**A:** 
- **Infura**: https://infura.io/ ï¼ˆå…è´¹ï¼‰
- **Alchemy**: https://www.alchemy.com/ ï¼ˆå…è´¹ï¼‰

### Q: ç§é’¥åœ¨å“ªé‡Œæ‰¾ï¼Ÿ
**A:** 
1. æ‰“å¼€ MetaMask
2. ç‚¹å‡»è´¦æˆ·è¯¦æƒ…
3. å¯¼å‡ºç§é’¥
4. âš ï¸ **æ°¸è¿œä¸è¦åˆ†äº«ä½ çš„ç§é’¥ï¼**

## ğŸ“ éƒ¨ç½²æ£€æŸ¥æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œè¯·ç¡®è®¤ï¼š

- [ ] åˆçº¦ç¼–è¯‘æˆåŠŸï¼ˆæ— é”™è¯¯ï¼‰
- [ ] åˆçº¦éƒ¨ç½²æˆåŠŸï¼ˆè·å¾—äº†åœ°å€ï¼‰
- [ ] æ›´æ–°äº† `contracts/addresses.ts`
- [ ] æ›´æ–°äº† `lib/Pool.json`
- [ ] é‡å¯äº†å‰ç«¯å¼€å‘æœåŠ¡å™¨
- [ ] åœ¨ Sepolia Etherscan ä¸Šèƒ½çœ‹åˆ°åˆçº¦
- [ ] é’±åŒ…æœ‰æµ‹è¯• Token
- [ ] æµ‹è¯• Token å·²æˆæƒç»™ PositionManager

## ğŸ¯ æµ‹è¯•æ­¥éª¤

1. **æ‰“å¼€å‰ç«¯** â†’ http://localhost:3000
2. **è¿æ¥é’±åŒ…** â†’ ç¡®ä¿åœ¨ Sepolia ç½‘ç»œ
3. **é€‰æ‹© Token** â†’ é€‰æ‹©ä¸¤ä¸ªæµ‹è¯• Token
4. **è¾“å…¥æ•°é‡** â†’ ä¾‹å¦‚å„ 1 ä¸ª
5. **æ·»åŠ æµåŠ¨æ€§** â†’ ç‚¹å‡»æŒ‰é’®
6. **æŸ¥çœ‹æ—¥å¿—** â†’ æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°

## âœ¨ æˆåŠŸçš„æ ‡å¿—

å¦‚æœçœ‹åˆ°ä»¥ä¸‹ä»»ä½•ä¸€æ¡ï¼Œè¯´æ˜ä¿®å¤æˆåŠŸï¼š

âœ… "Liquidity added successfully!" - å®Œç¾ï¼
âœ… "Pool index out of bounds" - æ­£å¸¸ï¼Œå‰ç«¯ä¼šè‡ªåŠ¨åˆ›å»ºæ± å­
âœ… "Pool not initialized" - æ­£å¸¸ï¼Œå‰ç«¯ä¼šè‡ªåŠ¨åˆå§‹åŒ–
âœ… æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯ï¼ˆè€Œä¸æ˜¯ "missing revert data"ï¼‰

## ğŸš€ å‡†å¤‡å¥½äº†å—ï¼Ÿ

æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤æ¸…å•æ‰§è¡Œï¼Œä½ çš„ DApp å¾ˆå¿«å°±èƒ½æ­£å¸¸å·¥ä½œäº†ï¼

å¦‚æœ‰é—®é¢˜ï¼ŒæŸ¥çœ‹ï¼š
- æµè§ˆå™¨æ§åˆ¶å°çš„è¯¦ç»†æ—¥å¿—
- `SOLUTION.md` è·å–æ›´å¤šæŠ€æœ¯ç»†èŠ‚
- Hardhat çš„éƒ¨ç½²è¾“å‡º

---

**ç¥ä½ éƒ¨ç½²æˆåŠŸï¼** ğŸ‰

