# ⚡ 立即执行步骤

## ✅ 已完成
- [x] 修复了 Factory.sol 的数组越界问题
- [x] 改进了 Pool.sol 的错误信息
- [x] 修复了 hardhat.config.ts 配置
- [x] 合约编译成功

## 📋 你需要做的（按顺序）

### 1️⃣ 配置环境变量（2分钟）

```bash
cd swap-contract
nano .env
```

粘贴以下内容并填写你的信息：

```env
SEPOLIA_RPC_URL=https://sepolia.infura.io/v3/YOUR_INFURA_KEY
PRIVATE_KEY=你的私钥不要0x前缀
```

**获取 RPC URL:**
- Infura: https://infura.io （免费注册）
- Alchemy: https://www.alchemy.com （免费注册）

**获取私钥:**
- MetaMask → 账户详情 → 导出私钥
- ⚠️ 只用测试钱包，不要用真钱的钱包！

保存文件：`Ctrl+X` → `Y` → `Enter`

### 2️⃣ 部署合约（5分钟）

```bash
# 确保在 swap-contract 目录
cd swap-contract

# 部署到 Sepolia
npx hardhat ignition deploy ignition/modules/MetaNodeSwap.ts --network sepolia
```

**📝 记录输出的地址！** 应该看到：
```
✔ Confirm deploy to network sepolia (11155111)? … yes
...
Deployed PoolManager: 0x...
Deployed SwapRouter: 0x...  
Deployed PositionManager: 0x...
```

### 3️⃣ 更新前端地址（1分钟）

```bash
# 回到项目根目录
cd ..

# 编辑地址文件
nano contracts/addresses.ts
```

替换为你刚才部署的地址：

```typescript
export const CONTRACT_ADDRESSES = {
  sepolia: {
    poolManager: '0x刚才部署的PoolManager地址',
    positionManager: '0x刚才部署的PositionManager地址',
    swapRouter: '0x刚才部署的SwapRouter地址',
  }
} as const;
```

保存：`Ctrl+X` → `Y` → `Enter`

### 4️⃣ 更新 Pool ABI（30秒）

```bash
# 从项目根目录执行
cp swap-contract/artifacts/contracts/MetaNodeSwap/Pool.sol/Pool.json lib/Pool.json
```

### 5️⃣ 重启前端（30秒）

```bash
# 如果前端正在运行，先停止（Ctrl+C）
# 然后重新启动
pnpm dev
```

### 6️⃣ 测试（1分钟）

1. 打开 http://localhost:3000
2. 连接钱包（确保在 Sepolia 网络）
3. 尝试添加流动性
4. 查看控制台日志

## ✅ 成功标志

你应该看到以下**之一**：

- ✅ "Liquidity added successfully!" ← 完美！
- ✅ "Pool index out of bounds" ← 正常，会自动创建池子
- ✅ "Pool not initialized" ← 正常，会自动初始化
- ✅ 任何清晰的错误信息（而不是 "missing revert data"）

## 🆘 如果遇到问题

### "insufficient funds for gas"
→ 去 https://sepoliafaucet.com/ 获取测试 ETH

### "Invalid RPC URL"  
→ 检查 .env 文件的 SEPOLIA_RPC_URL 是否正确

### "Invalid private key"
→ 确保私钥没有 0x 前缀，且长度正确（64个字符）

### 前端还是报错
→ 确认：
1. 是否更新了 contracts/addresses.ts？
2. 是否重启了前端？
3. 是否刷新了浏览器？

## 📞 需要帮助？

查看详细文档：
- `修复总结.md` - 完整说明
- `SOLUTION.md` - 英文版详细方案
- `CHANGES.md` - 所有改动的技术细节

---

**预计总耗时：10 分钟**

开始吧！💪

